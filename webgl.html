<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>My first Three.js app</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
        </style>
    </head>
    <body>
        <script src="three.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>
            socket = new WebSocket("ws://localhost:8080/fft");
            var scene = new THREE.Scene();
            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            document.body.appendChild( renderer.domElement );
            var material = new THREE.MeshBasicMaterial( { color: 0x00ff00 } );
            var first = true;
            socket.onmessage = function (e)
            {
                
                    $.each(JSON.parse(e.data),function(i,val){
                        scene.children[i] = new THREE.Mesh(new THREE.BoxGeometry( 0.05,0.1*val,0 ), material );
                        scene.children[i].position.setX(-13.5+0.1*i);
                        scene.children[i].position.setY(-6.9);
                    });
                
                
            };
            socket.onclose = function ()
            {
                for(i=0; i < scene.children.length; i++){
                     obj = scene.children[i];
                     scene.remove(obj);
                  }
            };
            var can_send = false;
            socket.onopen = function() {
                can_send = true;
            }
            function render() {
                requestAnimationFrame( render );
                renderer.render( scene, camera );
                if(can_send)
                    socket.send("hejsan");
            }
            render();

            camera.position.z = 10;
            
        </script>
    </body>
</html>